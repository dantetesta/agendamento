<!-- 
    Formulário de Recorrência - Para integrar no modal de agendamento
    Autor: Dante Testa (https://dantetesta.com.br)
    Data: 02/11/2025 17:12
    
    INSTRUÇÕES:
    1. Adicione este HTML dentro do modal de novo agendamento
    2. Coloque após os campos normais (cliente, data, horário, etc)
    3. Inclua os arquivos CSS e JS:
       - /assets/css/agendamento-recorrente.css
       - /assets/js/agendamento-recorrente.js
-->

<!-- Checkbox para ativar recorrência -->
<div class="mb-6">
    <div class="checkbox-repetir">
        <input type="checkbox" 
               id="repetir_agendamento" 
               name="repetir_agendamento"
               class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
        <label for="repetir_agendamento">
            <i class="fas fa-repeat"></i>
            Repetir este agendamento
        </label>
    </div>
</div>

<!-- Container de recorrência (inicialmente oculto) -->
<div id="container_recorrencia" class="hidden space-y-6 p-6 bg-gray-50 rounded-lg border-2 border-blue-200">
    
    <!-- Tipo de recorrência -->
    <div>
        <label for="tipo_recorrencia" class="label-com-icone">
            <i class="fas fa-calendar-alt"></i>
            Tipo de recorrência
        </label>
        <select id="tipo_recorrencia" 
                name="tipo_recorrencia"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Selecione...</option>
            <option value="diario">Diariamente</option>
            <option value="semanal" selected>Semanalmente</option>
            <option value="mensal">Mensalmente</option>
        </select>
    </div>
    
    <!-- Dias da semana (apenas para tipo semanal) -->
    <div id="campo_dias_semana" class="campo-recorrencia">
        <label class="label-com-icone">
            <i class="fas fa-calendar-week"></i>
            Repetir nos dias
        </label>
        <div class="dias-semana-grid">
            <div class="dia-semana-item">
                <input type="checkbox" id="dia_1" name="dias_semana[]" value="1">
                <label for="dia_1" class="dia-semana-label">
                    <span class="dia-semana-abrev">S</span>
                    <span class="dia-semana-nome">Seg</span>
                </label>
            </div>
            <div class="dia-semana-item">
                <input type="checkbox" id="dia_2" name="dias_semana[]" value="2">
                <label for="dia_2" class="dia-semana-label">
                    <span class="dia-semana-abrev">T</span>
                    <span class="dia-semana-nome">Ter</span>
                </label>
            </div>
            <div class="dia-semana-item">
                <input type="checkbox" id="dia_3" name="dias_semana[]" value="3">
                <label for="dia_3" class="dia-semana-label">
                    <span class="dia-semana-abrev">Q</span>
                    <span class="dia-semana-nome">Qua</span>
                </label>
            </div>
            <div class="dia-semana-item">
                <input type="checkbox" id="dia_4" name="dias_semana[]" value="4">
                <label for="dia_4" class="dia-semana-label">
                    <span class="dia-semana-abrev">Q</span>
                    <span class="dia-semana-nome">Qui</span>
                </label>
            </div>
            <div class="dia-semana-item">
                <input type="checkbox" id="dia_5" name="dias_semana[]" value="5">
                <label for="dia_5" class="dia-semana-label">
                    <span class="dia-semana-abrev">S</span>
                    <span class="dia-semana-nome">Sex</span>
                </label>
            </div>
            <div class="dia-semana-item">
                <input type="checkbox" id="dia_6" name="dias_semana[]" value="6">
                <label for="dia_6" class="dia-semana-label">
                    <span class="dia-semana-abrev">S</span>
                    <span class="dia-semana-nome">Sáb</span>
                </label>
            </div>
            <div class="dia-semana-item">
                <input type="checkbox" id="dia_7" name="dias_semana[]" value="7">
                <label for="dia_7" class="dia-semana-label">
                    <span class="dia-semana-abrev">D</span>
                    <span class="dia-semana-nome">Dom</span>
                </label>
            </div>
        </div>
    </div>
    
    <!-- Dia do mês (apenas para tipo mensal) -->
    <div id="campo_dia_mes" class="campo-recorrencia hidden">
        <label for="dia_mes" class="label-com-icone">
            <i class="fas fa-calendar-day"></i>
            Dia do mês
        </label>
        <select id="dia_mes" 
                name="dia_mes"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Selecione o dia...</option>
            <?php for($i = 1; $i <= 31; $i++): ?>
                <option value="<?= $i ?>">Dia <?= $i ?></option>
            <?php endfor; ?>
        </select>
    </div>
    
    <!-- Intervalo -->
    <div id="campo_intervalo" class="campo-recorrencia">
        <label for="intervalo" class="label-com-icone">
            <i class="fas fa-arrows-rotate"></i>
            A cada quantas semanas?
        </label>
        <input type="number" 
               id="intervalo" 
               name="intervalo"
               min="1" 
               max="12" 
               value="1"
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent input-recorrencia">
        <p class="text-sm text-gray-500 mt-1">
            <i class="fas fa-info-circle mr-1"></i>
            1 = toda semana, 2 = quinzenal, 3 = a cada 3 semanas, etc
        </p>
    </div>
    
    <!-- Data de início -->
    <div>
        <label for="data_inicio" class="label-com-icone">
            <i class="fas fa-calendar-plus"></i>
            Data de início
        </label>
        <input type="date" 
               id="data_inicio" 
               name="data_inicio"
               min="<?= date('Y-m-d') ?>"
               value="<?= date('Y-m-d') ?>"
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
               required>
    </div>
    
    <!-- Termina em -->
    <div>
        <label class="label-com-icone">
            <i class="fas fa-calendar-xmark"></i>
            Termina em
        </label>
        <div class="termina-opcoes">
            <div class="termina-opcao">
                <input type="radio" 
                       id="termina_nunca" 
                       name="termina" 
                       value="nunca" 
                       checked
                       class="mr-3">
                <label for="termina_nunca" class="flex-1 cursor-pointer">
                    Nunca (continua indefinidamente)
                </label>
            </div>
            
            <div class="termina-opcao">
                <input type="radio" 
                       id="termina_data" 
                       name="termina" 
                       value="data"
                       class="mr-3">
                <label for="termina_data" class="flex-1 cursor-pointer">
                    Em uma data específica
                </label>
                <input type="date" 
                       id="data_fim" 
                       name="data_fim"
                       min="<?= date('Y-m-d') ?>"
                       class="ml-3 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            
            <div class="termina-opcao">
                <input type="radio" 
                       id="termina_ocorrencias" 
                       name="termina" 
                       value="ocorrencias"
                       class="mr-3">
                <label for="termina_ocorrencias" class="flex-1 cursor-pointer">
                    Após
                </label>
                <input type="number" 
                       id="max_ocorrencias" 
                       name="max_ocorrencias"
                       min="1" 
                       max="100" 
                       value="10"
                       class="ml-3 w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center">
                <span class="ml-2">ocorrências</span>
            </div>
        </div>
    </div>
    
    <!-- Preview de datas -->
    <div>
        <label class="label-com-icone">
            <i class="fas fa-eye"></i>
            Preview das próximas datas
        </label>
        <div id="preview_datas" class="min-h-[100px]">
            <!-- Preview será inserido aqui via JavaScript -->
        </div>
    </div>
    
</div>

<!-- Adicione no final da página, antes do </body> -->
<script>
// Habilita/desabilita campos baseado na opção "Termina em"
document.querySelectorAll('input[name="termina"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.getElementById('data_fim').disabled = this.value !== 'data';
        document.getElementById('max_ocorrencias').disabled = this.value !== 'ocorrencias';
    });
});

// Inicializa estado dos campos
document.getElementById('data_fim').disabled = true;
document.getElementById('max_ocorrencias').disabled = true;
</script>
